/**
 * CONSTITUTIONAL POSTER PROTOCOL
 * 
 * The 9-Step Compiler for generating the Constitutional Poster.
 * Enforces strict Blueprint-Load separation and high-compression diagnostics.
 * 
 * Core Objective:
 * Treat the Poster as a SPEC SHEET for the instrument, not a "reading".
 * It describes capacity and design requirements, NEVER current state.
 */

export const CONSTITUTIONAL_POSTER_PROTOCOL = `
CONSTITUTIONAL POSTER PROTOCOL v4.0 (The Stone Beneath the River)

## Core Identity
The Constitutional Poster is NOT a report, NOT a mirror, NOT a card of weather.
It is a **symbolic compression of being** — the still image of the inner design.

It answers only one question:
> "What does my structure look like when all movement stops?"

## ⚠️ CRITICAL ARCHITECTURAL RULE: BLUEPRINT-LOAD PROTOCOL

**LANGUAGE DISCIPLINE:**
- **FORBIDDEN**: Weather metaphors, transient states, conditional activation language
  - ❌ "under pressure," "when strained," "during overload," "in crisis"
  - ❌ "foggy," "stormy," "clear," "volatile," "calm"
- **REQUIRED**: Constitutional/structural language describing permanent architectural characteristics
  - ✅ "capacity," "tolerance threshold," "failure mode," "structural design," "default mode"
  - ✅ "architecture," "mechanism," "operational mode," "gradient," "receptivity"

**THE DISTINCTION:**
- **Constitutional (This Poster)**: Describes **HOW THE VESSEL IS BUILT** → Capacity, thresholds, failure modes
- **Transit (Balance Meter/Reports)**: Describes **WHAT WEATHER IS HITTING THE VESSEL** → Magnitude, volatility, directional bias

The Blueprint is **weatherless**. It is the lighthouse, not the storm.

## E-PRIME ENFORCEMENT (Critical Linguistic Discipline)

**PROHIBITED**: "Is of identity" statements that freeze the user into a fixed state
- ❌ "You are silent" → Implies permanent identity
- ❌ "This is toxic" → Projects subjective judgment as objective fact
- ❌ "The relationship is broken" → Freezes dynamic into static label

**REQUIRED**: Structural tendency language that preserves agency
- ✅ "Foundation architecture defaults to silence at capacity"
- ✅ "This configuration correlates with high friction"
- ✅ "The relational field shows structural asymmetry"

**THE LOGIC**: The poster describes the **grain of the wood**—where it can bear weight, where it will snap if load is not distributed with agency. It does NOT declare what the user "is."

## BEHAVIORAL ANOMALY NORMALIZATION

**MANDATE**: Frame "anomalous" behaviors as **authentic expressions of underlying architecture**, not defects.

- **Containment ≠ Absence**: Unintegrated pressures remain active and seek expression through eruption or compulsion
- **Silence ≠ Emptiness**: Privacy mechanisms at threshold create fortress, not void
- **Binary Response ≠ Instability**: Some architectures operate in discrete states (efficiency/shutdown) without intermediate gradient

**EXAMPLE SHIFT**:
- ❌ "You're too intense" → Pathologizes
- ✅ "High-voltage engine requires robust containment architecture" → Normalizes as structural fact

## TOOL-FIRST FRAMING (Maintenance Manual, Not Oracle)

**PURPOSE**: The Constitutional Poster is a **pressure spine maintenance manual**, not a personality test or fate declaration.

**THE POSTER IDENTIFIES**:
1. **Load limits and tolerances** — Where the structure can bear weight
2. **Failure modes** — How specific chambers respond when threshold is exceeded  
3. **The Siphon** — How energy moves under load (e.g., creative engine → public canopy)
4. **Threshold indicators** — Early warning signals before capacity breach

**THE POSTER DOES NOT**:
- Predict outcomes or declare destiny
- Assign moral value ("good" or "bad" architecture)
- Freeze the user into a permanent identity label
- Suggest the structure cannot adapt or grow

**ONE-SENTENCE MISSION**: Map the grain of the wood—identify where the structure can bear weight and where it will snap if load is not distributed with agency.

## The Three Layers of the Poster

| Layer             | Role                                                      |
| ----------------- | --------------------------------------------------------- |
| **Geometry**      | The skeleton — exact natal positions and angles.          |
| **Polarity Axes** | The muscles — dynamic tensions that give it movement.     |
| **Seal Phrase**   | The breath — the living intention of the design.          |
| **Color & Space** | The atmosphere — the felt tone of the architecture.       |

---

## V4.0 POLARITY MANDATE (Critical Update)

Every living system is shaped by opposing forces held in dynamic balance.
Without polarities, the Poster risks becoming a symbol without anatomy.
The opposites are not conflict — they are the lungs of the design.

### 1. POLARITY AXES (Required: 3-5 Pairs)
Each polarity is a bridge between two kinds of movement.
Derive these from natal geometry (oppositions, squares, axis rulerships):

| Example Axis               | Function                                          |
| -------------------------- | ------------------------------------------------- |
| **Expression ↔ Containment** | How energy translates between speech and silence. |
| **Autonomy ↔ Union**         | How selfhood balances intimacy.                   |
| **Stability ↔ Change**       | How the system endures pressure and adapts.       |
| **Depth ↔ Lightness**        | How awareness moves between interior and exterior.|
| **Control ↔ Surrender**      | How agency interacts with fate or flow.           |

**Naming Convention:** Plain, poetic, one breath each.
Example format:
\`\`\`
GOLD ↔ IRON
SPEECH ↔ SILENCE
FIRE ↔ STONE
\`\`\`

### 2. AXIS GLYPHS (Visual Representation)
Each polarity can be represented as a **line or band** across the Poster:
- Two symbols at either end (e.g., ♌︎ Sun/Leo ↔ ♉︎ Moon/Taurus)
- Midpoint marked as the **living tension point** — not compromise, but exchange.

### 3. THE CENTRAL SEAL (Required)
At the center sits the **Constitutional Sentence** — the distilled Voice:
> "A kiln built into a library — silence hardens your words."

This sentence acts as *the hinge* around which the polarities orbit.
It gives the viewer a felt sense of what all the axes are trying to resolve.

### 4. COLOR & WEIGHT ENCODING
Color gradients subtly express polarity balance:
- **Warm tones** radiating outward = expressive, expansive fields (Fire, Jupiter)
- **Cool/dark tones** grounding inward = containing, stabilizing fields (Saturn, Earth)
- **Midline gradient** marks the living midpoint

---

## The Six-Section Layout (Mandatory Schema)

### 1. Header (Context)
*   Subject Name, Birth Data
*   **Hero Quote**: A single, defining sentence.
*   **Hook Stack** (MANDATORY — The Diagnostic Pulse):
    The Hook Stack is the two-line diagnostic resonance that opens every poster.
    It answers: "What's the felt movement between the two poles?"
    
    *   **Line 1 (Primary Hook):** The core behavioral rhythm — what they would recognize in themselves. 3-5 words.
        Example: "Depth seeks horizon." / "Feels deeply, moves far."
    *   **Line 2 (Paradox Hook):** The countercurrent that keeps the system honest — the friction that animates the rhythm. 3-5 words.
        Example: "The tide learns to run." / "Builds safety through motion."
    
    Without this pair, you have data (FIELD + MAP) but no resonance (VOICE).

### 2. The Compass (Orientation Plate)
*   Definitions for Sun, Moon, Asc, MC, IC.
*   **Right-Edge Metrics**:
    *   **Elemental Bias**: e.g., "Fire > Earth"
    *   **Mode**: e.g., "Cardinal"
    *   **Agency Tone**: e.g., "Self-propelled"
    *   **Anchor**: e.g., "Taurus MC"

### 3. Opening Signals (The Three-Signal Rhythm)

The poster must contain exactly **THREE polarity signals** that complete the psychological arc from micro to macro:

**SIGNAL 1 — Self/Creative (Personal Core)**
*   Derived from: Sun, Moon, and their geometric relationship
*   Focus: The internal engine — how identity and emotion interact
*   Example: "Creative Expression vs. Practical Stability"
    *   Sun in Leo (9th House) vs. Moon in Taurus (7th House)
    *   The tension between bold self-expression and grounded emotional needs.

**SIGNAL 2 — Relational/Interactive (Interface)**
*   Derived from: Ascendant, Mercury, Mars
*   Focus: How the self meets the world — communication and action style
*   Example: "Communication vs. Action"
    *   Mercury in Virgo (11th House) vs. Mars in Aries (6th House)
    *   The tension between precise articulation and impulsive movement.

**SIGNAL 3 — Structural/Transpersonal (System Logic)**
*   Derived from: Jupiter, Saturn (and their geometric relationship)
*   Focus: The macro pattern — how vision and control negotiate
*   Example: "Vision vs. Verification"
    *   Jupiter in Aquarius (3rd House) vs. Saturn in Gemini (8th House)
    *   The tension between radical expansion and forensic audit.
    *   Air–Air resonance: ideas must pass rigorous stress-test.

**Format for each signal:**
\`\`\`
SIGNAL [N]
[Label A] vs. [Label B]
[Planet A] in [Sign] ([House]) vs. [Planet B] in [Sign] ([House])
[One-line tension statement]
[Elemental resonance note if applicable]
\`\`\`

This three-signal structure completes: **Self → Interface → System**

### 4. The Acorn (12 Chambers)
*   Standard 12-house iteration (Active/Ambient).
*   **CRITICAL REQUIREMENT**: Each chamber MUST include unique, contextual behavioral analysis.
*   
*   **For Each Chamber, Generate:**
*   
*   1. **narrative**: The general function and planetary signature (as currently done)
*   2. **behaviorUnderStrain**: The structural failure mode or tolerance threshold of this chamber
*      - **CRITICAL RULE**: Use CONSTITUTIONAL LANGUAGE ONLY → Describe capacity, tolerances, failure modes, structural design
*      - **FORBIDDEN**: Weather/transient language like "under pressure," "when strained," "during overload"
*      - **REQUIRED**: Describe the PERMANENT ARCHITECTURAL CHARACTERISTIC of how this chamber is built to respond
*      - **BASE DESCRIPTION ON**:
*        - The planets present (engines that define operational mode)
*        - The sign on the cusp (material/tolerance specification)
*        - The house's natural function (structural purpose)
*        - The current type (FOUNDATION, FLOW, or CONTAINMENT)
*      - **Examples (CONSTITUTIONAL LANGUAGE)**:
*        - House 1 (Libra Asc, Uranus/Pluto): "Interface has low tolerance for authenticity/diplomacy conflict—default failure mode is polarization between radical truth and diplomatic freeze."
*        - House 4 (Empty, Earth sign): "Foundation architecture defaults to silence at capacity—privacy mechanism hardens into isolation when threshold exceeded."
*        - House 6 (Stellium in Aries): "Workshop operates in binary mode—hyper-efficiency or complete shutdown, no gradient between states."
*        - House 8 (Empty, Water): "Depths chamber has maximum receptivity—merging process lacks internal resistance, becomes sanctuary or dissolution based on external input."
*   
*   3. **guidance**: A single, actionable directive for this chamber
*      - **RULE**: Context-specific, not generic
*      - **Examples**:
*        - "Monitor thresholds before depletion."
*        - "Allow the silence to restore structure."
*        - "Channel fire through focused action, not scattered reaction."

### 5. Structural Flow (The System Logic)
*   **Primary Movement**: General direction.
*   **Flow Line**: Directional indicator (e.g., "From exploration to stability · fire into earth · motion seeking form").
*   **Constitutional Flow**: Three-step schematic sequence (e.g., ["Exploration", "Integration", "Contribution"]).
*   **System Signature**: Two-word polarity.

### 6. The Seal (Constitutional Sentence)
*   The distilled Voice from the Solo Mirror.
*   Functions as the hinge around which all polarities orbit.
*   Example: "A kiln built into a library — silence hardens your words."

---

## Formatting Rules
*   **JSON Output**: The response must be valid JSON matching the \`BlueprintPosterData\` schema.
*   **Strings**: Keep them clean. No Markdown in JSON values.

## Final Polish Checks
*   Did I use the word "currently"? -> **DELETE IT.**
*   Did I report a transit? -> **DELETE IT.**
*   Did I include at least 3 Core Polarities? -> **REQUIRED.**
*   Did I use "Ambient / Responsive" for empty houses? -> **CHECK.**
*   Is there a Constitutional Seal? -> **REQUIRED.**

---

## In Raven's Voice

> The Poster must remember the opposites that built you.
> Without them, it forgets motion and becomes decoration.
>
> The opposites are not conflict — they are the lungs of the design.
> Each breath is a negotiation between fire and stone.
>
> The Constitutional Poster shows that breath frozen in image:
> still, but alive with pressure.
`;

/**
 * Prompt Builder
 */
export function buildConstitutionalPosterPrompt(): string {
    return CONSTITUTIONAL_POSTER_PROTOCOL;
}
